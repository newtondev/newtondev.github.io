<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-adsense-account" content="ca-pub-5206656295129943"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Kubernetes on AWS — gotcha when using EFS" /><meta property="og:locale" content="en" /><meta name="description" content="A place where I can share my experiences with all things Kubernetes and Technology related." /><meta property="og:description" content="A place where I can share my experiences with all things Kubernetes and Technology related." /><link rel="canonical" href="https://newtondev.github.io/posts/kubernetes-on-aws-gotcha-when-using-efs/" /><meta property="og:url" content="https://newtondev.github.io/posts/kubernetes-on-aws-gotcha-when-using-efs/" /><meta property="og:site_name" content="Craig Newton" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-22T13:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Kubernetes on AWS — gotcha when using EFS" /><meta name="twitter:site" content="@craignewtondev" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-22T13:00:00+01:00","datePublished":"2022-02-22T13:00:00+01:00","description":"A place where I can share my experiences with all things Kubernetes and Technology related.","headline":"Kubernetes on AWS — gotcha when using EFS","mainEntityOfPage":{"@type":"WebPage","@id":"https://newtondev.github.io/posts/kubernetes-on-aws-gotcha-when-using-efs/"},"url":"https://newtondev.github.io/posts/kubernetes-on-aws-gotcha-when-using-efs/"}</script><title>Kubernetes on AWS — gotcha when using EFS | Craig Newton</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Craig Newton"><meta name="application-name" content="Craig Newton"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://pbs.twimg.com/profile_images/1573218316889595904/hncWRiAJ_400x400.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Craig Newton</a></div><div class="site-subtitle font-italic">DevOps Engineer and Technology Evangelist</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/newtondev" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/craignewtondev" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/craig-newton-18a31923/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://craignewtondev.medium.com/" aria-label="medium" target="_blank" rel="noopener"> <i class="fab fa-medium"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Kubernetes on AWS — gotcha when using EFS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Kubernetes on AWS — gotcha when using EFS</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1645531200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 22, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/craignewtondev">Craig Newton</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="362 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/2022/02/dont_panic.jpg" alt="Kubernetes on AWS - gotcha when using EFS" data-proofer-ignore></p><p>I was happily migrating a lot of applications over to EKS when my pods went into an <strong>Init</strong> state. Panic set in and I was having a look around at what the problem could be (what is it this time, I said to myself).</p><p>For this specific Kubernetes cluster I was using a single <strong>EFS</strong> volume for all my deployments into quite a few separate namespaces. The problem I eventually faced was that when you create a persistent volume, it registers as an <strong>Access Point</strong> on an <strong>EFS mount</strong> … and turns out there is a <strong>hard limit of 120 Access Points for each file system</strong>. So when I hit this limit, my new pods failed to provision persistent volumes. PANIC STATIONS!</p><p>The way I got around this limitation was to <strong>create additional EFS volumes</strong> and <strong>deploy multiple EFS storage classes in Kubernetes</strong> tied to these new volumes and <strong>balance out the allocation</strong> of new application deployments to those new storage classes. For now that seems to be working stable, but I will keep you posted if there are any changes or updates. The other limit on EFS to keep a keen eye on is <strong>“Number of mount targets for each VPC”</strong> which is <strong>400</strong>.</p><p>Have you encountered this issue? What do you think is the best way to solve the problem? Did this post help you in any way? Please feel free to comment below.</p><p>Ensure you read and understand the limits imposed on EFS, the hard limits stop you dead in your tracks.</p><p>Following are the quotas on Amazon EFS resources for each customer account in an AWS Region:</p><ul><li>Number of access points for each file system = 120<li>Number of connections for each file system = 25,000<li>Number of mount targets for each file system in an Availability Zone = 1<li>Number of mount targets for each VPC = 400<li>Number of security groups for each mount target = 5<li>Number of tags for each file system = 50<li>Number of VPCs for each file system = 1</ul><p>More here: <a href="https://docs.aws.amazon.com/efs/latest/ug/limits.html">https://docs.aws.amazon.com/efs/latest/ug/limits.html</a></p><p>Also ensure when you are using Amazon EFS CSI driver that the limits are also imposed here: <a href="https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html">https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>kubernetes</a>, <a href='/categories/aws/'>aws</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/efs/" class="post-tag no-text-decoration" >efs</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kubernetes+on+AWS+%E2%80%94+gotcha+when+using+EFS+-+Craig+Newton&url=https%3A%2F%2Fnewtondev.github.io%2Fposts%2Fkubernetes-on-aws-gotcha-when-using-efs%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kubernetes+on+AWS+%E2%80%94+gotcha+when+using+EFS+-+Craig+Newton&u=https%3A%2F%2Fnewtondev.github.io%2Fposts%2Fkubernetes-on-aws-gotcha-when-using-efs%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnewtondev.github.io%2Fposts%2Fkubernetes-on-aws-gotcha-when-using-efs%2F&text=Kubernetes+on+AWS+%E2%80%94+gotcha+when+using+EFS+-+Craig+Newton" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cron/">cron</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/efs/">efs</a> <a class="post-tag" href="/tags/eip/">eip</a> <a class="post-tag" href="/tags/gateways/">gateways</a> <a class="post-tag" href="/tags/gcp/">gcp</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/how-to-assign-an-eip-to-an-aws-nlb-in-kubernetes/"><div class="card-body"> <em class="small" data-ts="1559995200" data-df="ll" > Jun 8, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to assign an EIP to an AWS NLB in Kubernetes</h3><div class="text-muted small"><p> Out of the box Kubernetes has no support for assigning an EIP to an AWS Network Load Balancer. There is currently a pull request for this feature listed here: https://github.com/kubernetes/kubernet...</p></div></div></a></div><div class="card"> <a href="/posts/public-and-private-istio-ingress-gateways-on-aws/"><div class="card-body"> <em class="small" data-ts="1567166400" data-df="ll" > Aug 30, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Public and Private Istio Ingress Gateways on AWS</h3><div class="text-muted small"><p> By default, istio creates a service with a publicly accessible classic load balancer (ELB). However, there are times where we only want access from our internal network or a network we are connec...</p></div></div></a></div><div class="card"> <a href="/posts/building-a-kubernetes-cluster-from-scratch/"><div class="card-body"> <em class="small" data-ts="1657368000" data-df="ll" > Jul 9, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Kubernetes cluster on AWS from scratch</h3><div class="text-muted small"><p> These days rolling out a Kubernetes cluster on any cloud provider is quite simple and easy, but not always cost effective. Us as DevOps/Ops Engineers are spoilt with the ease of configuration and...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/how-to-run-a-kubernetes-cron-job-manually-as-a-one-time-job/" class="btn btn-outline-primary" prompt="Older"><p>How to run a Kubernetes cron job manually as a one time job</p></a> <a href="/posts/how-i-passed-the-ine-certified-cloud-associate-icca-exam/" class="btn btn-outline-primary" prompt="Newer"><p>How I passed the INE Certified Cloud Associate (ICCA) Exam</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/craignewtondev">Craig Newton</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cron/">cron</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/efs/">efs</a> <a class="post-tag" href="/tags/eip/">eip</a> <a class="post-tag" href="/tags/gateways/">gateways</a> <a class="post-tag" href="/tags/gcp/">gcp</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Z9HKJNH86F"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Z9HKJNH86F'); }); </script>
